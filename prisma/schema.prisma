// This is your Prisma schema file

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Category {
  id            String        @id @default(uuid())
  name          String
  description   String?
  subcategories Subcategory[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model Subcategory {
  id          String   @id @default(uuid())
  name        String
  description String?
  category    Category @relation(fields: [categoryId], references: [id])
  categoryId  String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Brand {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum TypeMicronutrient {
  VITAMIN              @map("Vitamina")
  MINERAL              @map("Mineral")
  FATTY_ACID           @map("Ácido graso")
  AMINO_ACID           @map("Aminoácido")
  ANTIOXIDANT_COMPOUND @map("Antioxidante")
  PROBIOTIC            @map("Probiótico")
  PHYTONUTRIENT        @map("Fitonutriente")
}

enum AllergenType {
  NONE      @map("Ninguno")
  GLUTEN    @map("Gluten")
  LACTOSE   @map("Lactosa")
  NUTS      @map("Frutos secos")
  PEANUTS   @map("Cacahuetes")
  SOY       @map("Soja")
  EGGS      @map("Huevos")
  FISH      @map("Pescado")
  SHELLFISH @map("Marisco")
  CELERY    @map("Apio")
  MUSTARD   @map("Mostaza")
  SESAME    @map("Sésamo")
  SULFITES  @map("Sulfitos")
  LUPIN     @map("Altramuces")
  MOLLUSCS  @map("Moluscos")
}

enum OriginType {
  ANIMAL    @map("Animal")
  VEGETAL   @map("Vegetal")
  SYNTHETIC @map("Sintético")
  MINERAL   @map("Mineral")
  MICROBIAL @map("Microbial")
}

enum AdditiveType {
  NO              @map("No es aditivo")
  SWEETENER       @map("Edulcorante")
  PRESERVATIVE    @map("Conservante")
  COLORANT        @map("Colorante")
  EMULSIFIER      @map("Emulsionante")
  FLAVOR_ENHANCER @map("Potenciador del sabor")
  STABILIZER      @map("Estabilizador")
  THICKENER       @map("Espesante")
}

enum RiskLevel {
  NONE   @map("Ninguno")
  LOW    @map("Bajo")
  MEDIUM @map("Medio")
  HIGH   @map("Alto")
}

enum RiskType {
  CARCINOGENIC        @map("Carcinogénico")
  ALLERGENIC          @map("Alergénico")
  INFLAMMATORY        @map("Inflamatorio")
  ENDOCRINE_DISRUPTOR @map("Disruptor endocrino")
  NEUROTOXIC          @map("Neurotóxico")
  MUTAGENIC           @map("Mutagénico")
  HEPATOTOXIC         @map("Hepatotóxico")
  CARDIOTOXIC         @map("Cardiotóxico")
  OBESOGENIC          @map("Obesogénico")
  HIGH_GI             @map("Alto índice glucémico")
  ADDICTIVE           @map("Adictivo")
  CONTAMINANTS        @map("Contaminantes")
  ANTINUTRIENTS       @map("Antinutrientes")
}

model Ingredient {
  id                 String                    @id @default(uuid())
  name               String                    @db.VarChar(100)
  scientificName     String?                   @db.VarChar(100)
  isBasicFood        Boolean                   @default(false)
  description        String?                   @db.Text
  allergenType       AllergenType              @default(NONE)
  origin             OriginType
  additiveType       AdditiveType              @default(NO)
  servingSize        Decimal?                  @db.Decimal(10, 2)
  servingMeasurement String?                   @db.VarChar(20)
  calories           Decimal                   @db.Decimal(10, 2)
  proteins           Decimal?                  @db.Decimal(10, 2)
  carbohydrates      Decimal?                  @db.Decimal(10, 2)
  sugars             Decimal?                  @db.Decimal(10, 2)
  fats               Decimal?                  @db.Decimal(10, 2)
  saturatedFats      Decimal?                  @db.Decimal(10, 2)
  fiber              Decimal?                  @db.Decimal(10, 2)
  risks              IngredientRisk[]
  micronutrients     IngredientMicronutrient[]
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt

  @@map("ingredients")
}

model IngredientRisk {
  id           String     @id @default(uuid())
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id], onDelete: Cascade)
  ingredientId String
  riskType     RiskType
  level        RiskLevel  @default(NONE)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@unique([ingredientId, riskType])
  @@map("ingredient_risks")
}

enum SolubilityType {
  FAT_SOLUBLE         @map("Soluble en grasa")
  WATER_SOLUBLE       @map("Soluble en agua")
  INORGANIC           @map("Inorgánico / Iónico")
  BIOCONVERTIBLE      @map("Requiere conversión metabólica")
  AMPHIPHILIC         @map("Anfipático (hidrofílico y lipofílico)")
  TRANSPORT_DEPENDENT @map("Requiere transportador/cofactor")
  N_A                 @map("No aplica")
}

enum FunctionType {
  VISION               @map("Salud visual")
  IMMUNE_SUPPORT       @map("Soporte inmunológico")
  ENERGY_METABOLISM    @map("Metabolismo energético")
  BONE_HEALTH          @map("Salud ósea")
  BLOOD_HEALTH         @map("Salud sanguínea")
  ANTIOXIDANT          @map("Antioxidante")
  NEUROTRANSMITTER     @map("Síntesis de neurotransmisores")
  CELL_GROWTH          @map("Crecimiento y reparación celular")
  OXYGEN_TRANSPORT     @map("Transporte de oxígeno")
  ENZYMATIC            @map("Cofactor enzimático")
  ELECTROLYTE          @map("Balance de electrolitos")
  HORMONE_REGULATION   @map("Regulación hormonal")
  GLUCOSE_REGULATION   @map("Regulación de la glucosa")
  ANTI_INFLAMMATORY    @map("Antiinflamatorio")
  CARDIOPROTECTIVE     @map("Cardioprotector")
  NEUROPROTECTIVE      @map("Neuroprotector")
  ESSENTIAL_FATTY_ACID @map("Ácido graso esencial")
  COLLAGEN             @map("Formación de colágeno")
  MUSCLE_GROWTH        @map("Crecimiento muscular")
  GUT_BARRIER          @map("Integridad de la barrera intestinal")
  NUTRIENT_ABSORPTION  @map("Absorción de nutrientes")
  HORMONE_PRECURSOR    @map("Precursor hormonal")
  SKIN_HEALTH          @map("Salud de la piel")
  ANTI_CANCER          @map("Anticancerígeno")
  IMMUNE_MODULATOR     @map("Modulador inmunológico")
  STRUCTURAL           @map("Función estructural")
  DETOXIFICATION       @map("Desintoxicación")
  GUT_MICROBIOME       @map("Modulación de microbioma intestinal")
  DNA_SYNTHESIS        @map("Síntesis de ADN")
  LIGHT_FILTER         @map("Filtración de luz")
}

enum EssentialityType {
  ESSENTIAL               @map("Esencial")
  CONDITIONALLY_ESSENTIAL @map("Condicionalmente esencial")
  NON_ESSENTIAL           @map("No esencial")
  BENEFICIAL              @map("Beneficioso pero no esencial")
  UNCLEAR                 @map("Esencialidad no determinada")
}

enum SourceType {
  EXOGENOUS             @map("Exógeno (solo fuentes externas)")
  ENDOGENOUS            @map("Endógeno (sintetizado internamente)")
  PARTIAL_SYNTHESIS     @map("Síntesis parcial (precursor requerido)")
  MICROBIOTA            @map("Sintetizado por microbiota intestinal")
  DUAL_SOURCE           @map("Fuente dual (sintetizado y dietético)")
  CONDITIONAL_SYNTHESIS @map("Síntesis condicional (limitada por factores)")
  STORAGE_DEPENDENT     @map("Dependiente de reservas corporales")
  SYNTHETIC             @map("Sintético (suplementos)")
}

enum BioactiveType {
  RETINOID              @map("Retinoide")
  CAROTENOID            @map("Carotenoide")
  TOCOPHEROL            @map("Tocoferol")
  TOCOTRIENOL           @map("Tocotrienol")
  NAPHTHOQUINONE        @map("Naftoquinona")
  SECOSTEROID           @map("Secosteroide")
  FLAVIN                @map("Flavina")
  NICOTINAMIDE          @map("Nicotinamida")
  PYRIDOXINE            @map("Piridoxina")
  COBALAMIN             @map("Cobalamina")
  ASCORBATE             @map("Ascorbato")
  THIAMINE              @map("Tiamina")
  FOLATE                @map("Folato")
  PANTOTHENATE          @map("Pantotenato")
  BIOTIN                @map("Biotina")
  CHOLINE               @map("Colina")
  ESSENTIAL_MINERAL     @map("Mineral esencial")
  TRACE_ELEMENT         @map("Oligoelemento")
  BIOFLAVONOID          @map("Bioflavonoide")
  POLYPHENOL            @map("Polifenol")
  ORGANOSULFUR          @map("Organoazufrado")
  XANTHOPHYLL           @map("Xantofila")
  QUINONE               @map("Quinona")
  BETAINE               @map("Betaína")
  PHOSPHOLIPID          @map("Fosfolípido")
  AMINO_ACID_DERIVATIVE @map("Derivado de aminoácido")
  TERPENOID             @map("Terpenoide")
  ALKALOID              @map("Alcaloide")
  GLUCOSINOLATE         @map("Glucosinolato")
  PHYTOSTEROL           @map("Fitoesterol")
  PROBIOTIC_STRAIN      @map("Cepa probiótica")
  PREBIOTIC             @map("Prebiótico")
}

model Micronutrient {
  id                  String                    @id @default(uuid())
  name                String                    @db.VarChar(100)
  description         String?                   @db.Text
  type                TypeMicronutrient
  tolerableLimit      String?
  unit                String                    @db.VarChar(20)
  dailyRecommendation String?
  ingredients         IngredientMicronutrient[]
  solubility          SolubilityType
  function            FunctionType[]
  essentiality        EssentialityType
  source              SourceType
  bioactiveType       BioactiveType
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt

  @@map("micronutrients")
}

model IngredientMicronutrient {
  ingredient      Ingredient    @relation(fields: [ingredientId], references: [id], onDelete: Cascade)
  ingredientId    String
  micronutrient   Micronutrient @relation(fields: [micronutrientId], references: [id])
  micronutrientId String
  amount          Decimal       @db.Decimal(10, 2)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@id([ingredientId, micronutrientId])
  @@map("ingredient_micronutrients")
}
